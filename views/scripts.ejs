<!-- views/scripts -->
<script>
    function getCurrentRoute() {
        const fullPath = window.location.pathname;
        const parts = fullPath.split('/');

        // Get the first part of the route (after removing the leading slash)
        let baseRoute = parts[2] || '';

        // Remove the hash if it exists
        if (baseRoute.includes('#')) {
            baseRoute = baseRoute.split('#')[0];
        }
        return `/${baseRoute}`;
    }

    // Function to update the "active" class based on the current route
    function updateActiveClass() {
        const currentRoute = getCurrentRoute();

        // Remove the "active" class from all links
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.classList.remove('active');
        });

        // Add the "active" class to the link with a matching route
        const activeLink = document.getElementById(currentRoute);
        if (activeLink) {
            activeLink.classList.add('active');
        }
    }

    // Add click event listeners to all sidebar links
    document.querySelectorAll('.sidebar-link').forEach(link => {
        if(link){
            link.addEventListener('click', updateActiveClass);
        }
    });

    // Update the "active" class on page load
    window.addEventListener('load', updateActiveClass);


    const sidebar = document.getElementById('sidebar');
    const span_data = sidebar.querySelectorAll('span');
    const toggleButton = document.querySelector('#toggleButton');
    const content = document.querySelector('.content');
    
    sidebar.addEventListener('mouseenter', () => {
        if (sidebar.classList.contains('shrink')) {
            sidebar.style.width = "250px";                
            content.classList.toggle('expand');
            content.classList.add('expand');
            content.style.marginLeft = "250px";
            span_data.forEach(span => {
                span.style.display = "block";
            });
            toggleButton.style.left = "260px";
        }
    });

    sidebar.addEventListener('mouseleave', () => {
        if (sidebar.classList.contains('shrink')) {
            sidebar.style.width = "50px";                
            content.classList.toggle('expand');
            content.classList.add('expand');
            content.style.marginLeft = "50px";
            span_data.forEach(span => {
                span.style.display = "none";
            });
            toggleButton.style.left = "60px";
        }
    });

    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        if(sidebar.classList.contains('shrink')){
            sidebar.classList.remove('shrink');
            sidebar.style.width = "250px";                
            content.classList.toggle('expand');
            content.classList.add('expand');
            content.style.marginLeft = "250px";
            span_data.forEach(span => {
                span.style.display = "block";
            });
            toggleButton.style.left = "260px";
        }
        else{
            sidebar.classList.toggle('shrink');
            sidebar.classList.add('shrink');
            sidebar.style.width = "50px";
            content.classList.toggle('expand');
            content.classList.add('expand');
            content.style.marginLeft = "50px";
            span_data.forEach(span => {
                span.style.display = "none";
            });
            toggleButton.style.left = "60px";
        }
    }

    // Function to change the page
    function changePage(pageNumber) {
        const entriesPerPage = document.getElementById('showEntries').value;

        // Make an AJAX request to the server with the updated page number
        fetch(`/dashboard/<%= route %>?page=${pageNumber}&entriesPerPage=${entriesPerPage}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.text())
        .then(data => {
            // Update the content of the container with the new data
            const section = document.querySelector('section');
            if (section) {
                section.innerHTML = data;

                document.querySelector('.content').style.marginLeft = '0';
                document.querySelector('.content').style.width = '100%';
                document.querySelector('.content').style.padding = '0%';
                updateActiveClass()
            }

            // Update the URL to reflect the current page
            const newUrl = `/dashboard/<%= route %>?page=${pageNumber}&entriesPerPage=${entriesPerPage}`;
            history.pushState({ page: pageNumber, entriesPerPage }, '', newUrl);
            window.location.reload()
        })
        .catch(error => {
            console.error('Error:', error);
            // Handle errors as needed
        });
    }

    function changeEntriesPerPage(selectElement) {
        const selectedValue = selectElement.value;
        const currentPage = <%= currentPage %> // Get the current page
        window.location.href = `/dashboard/<%= route %>?page=${currentPage}&entriesPerPage=${selectedValue}`;
    }

    function performSearch() {
        const searchInput = document.getElementById('searchInput');
        const searchQuery = searchInput.value.trim(); // Get the trimmed search query
        const pageNumber = 1;
        const entriesPerPage = document.getElementById('showEntries').value;

        // Make an AJAX request to the server with the search query and current page
        fetch(`/dashboard/<%= route %>?page=${pageNumber}&entriesPerPage=${entriesPerPage}&search=${searchQuery}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.text())
        .then(data => {
            // Update the content of the container with the new data
            const section = document.querySelector('section');
            if (section) {
                section.innerHTML = data;

                document.querySelector('.content').style.marginLeft = '0';
                document.querySelector('.content').style.width = '100%';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            // Handle errors as needed
        });
    }

    function formatNumber(amount) {
        // Use toLocaleString to add commas as separators for thousands
        // and toFixed(2) to ensure two decimal places
        return parseFloat(amount).toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2 
        });
    }

    // Date and Time Decoder
    function date_decoder(utcTime) {
        var utcDate = new Date(utcTime);
        var options = {
        year: 'numeric',
        month: 'long',
        day: '2-digit',
        };
        var utcPlus8Time = utcDate.toLocaleString('en-US', options);
        
        return utcPlus8Time;
    }

</script>
</body>
</html>